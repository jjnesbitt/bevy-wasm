<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Hello World - Rust</title>
    <script type="module">
        import init from "./client.js";

        // This is necessary since a fake error is always thrown
        try {
            await init("client_bg.wasm");
        } catch (error) {
            if (!error.message.startsWith("Using exceptions for control flow, don't mind me. This isn't actually an error!")) {
                throw error;
            }
        }

        // Test web socket
        const exampleSocket = new WebSocket("ws://localhost:3000");
        const sendMessage = (message) => {
            exampleSocket.send(`MESSAGE! ${Math.random()}`);
        }

        const genRanHex = size => [...Array(size)].map(() => Math.floor(Math.random() * 16).toString(16)).join('');
        exampleSocket.onopen = (event) => {
            // First thing to do is to send this client's UUID
            exampleSocket.send(genRanHex(8));

            // TODO: Get player position from wasm and send
            // setInterval(() => sendMessage("asd"), 100);
        };
    </script>
</head>

<body></body>

</html>
